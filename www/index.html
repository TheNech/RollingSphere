<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Rolling Sphere</title>
	<script type="text/javascript" src="./lib/socket.io.js"></script>
	<script type="text/javascript" src="./lib/jquery.min.js"></script>
	<script type="text/javascript" src="./lib/three.min.js"></script>
	<script type="text/javascript" src="./lib/OrbitControls.js"></script>
	<script type="text/javascript" src="./bootstrap/js/bootstrap.min.js"></script> 

	<link href="./css/style.css" rel="stylesheet">
	<link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="./bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
</head>
<body>
	<div id="container"></div>

	<div id="overlay-start">
		<p>Rolling Sphere</p>
		<form id="inputs">			
			<input id="inputNickname" class="form-control" name="nickname" placeholder="Your nickname">
			<input id="inputPassword" class="form-control" name="password" placeholder="Your password" type="password">
			<div id="validationAuth"></div>
			<div id="buttons">
				<button id="btnReg" class="btn-link active" type="button">Registration</button>
				<button id="btnEnter" class="btn btn-primary" type="button">Login</button>	
			</div>
		</form>		
	</div>

	<script type="text/javascript">	

		var bestScore, numberOfCoins, timeInGame;

		$("#btnEnter").on('click', (function() {

			var nick = $('#inputNickname').val(),
				pass = $('#inputPassword').val();

			if (nick.length == 0 || pass.length == 0) {
				document.getElementById('validationAuth').style.display = 'block';
				document.getElementById('validationAuth').innerHTML = 'Not all fields are filled';
			} else {
				socket.emit('auth', { username: nick, password: pass });						
			}

			socket.on('auth', function (data) {
				if (data.successfully) {

					socket.on('authorized', function (data) {

						$('#overlay-start').fadeOut(50);
						$('#mainScreen').fadeIn(50);
						document.getElementById('mainScreenElements').style.visibility = "visible";

						bestScore = data.bestScore;
						numberOfCoins = data.numberOfCoins;
						timeInGame = data.timeInGame;
						$('#mainScreenStatistic p:nth-child(1)').text('Nickname: ' + nick);
						$('#mainScreenStatistic p:nth-child(2)').text('Best score: ' + bestScore);
						$('#mainScreenStatistic p:nth-child(3)').text('Coins: ' + numberOfCoins);
						$('#mainScreenStatistic p:nth-child(4)').text('Total time: ' + Math.floor(timeInGame / 1000) + 's');
					});

					socket.on('update-online', function (data) {
						$('#mainScreenOnline p').text('Online: ' + data.pOnline);
					});

					socket.on('update-top-score', function (data) {
						console.log('top score');
					});
				} else {
					document.getElementById('validationAuth').style.display = 'block';
					document.getElementById('validationAuth').innerHTML = 'Authorization failed';
				}
			});
		}));

		
		$("#inputs").trigger('reset');		
	</script>
	
	<div id="modalBoxReg" class="modal fade" data-backdrop="static">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" type="button" data-dismiss="modal">
						&times;
					</button>
					<h4 class="modal-title">Registration</h4>
				</div>
				<div class="modal-body">
					<form id="inpReg">
						<input id="inputNick" class="form-control" name="nickname" placeholder="Your nickname" required>
						<input id="inputPass" class="form-control" name="password" placeholder="Your password" type="password">	
						<input id="inputRepeatPass" class="form-control" name="repeatPass" placeholder="Repeat your password" type="password">
					</form>
					<div id="validationReg"></div>
				</div>				
				<div class="modal-footer">
					<button id="btnRegRegistr" class="btn btn-primary" type="button">Registration</button>
					<button id="btnRegClose" class="btn btn-danger" type="button" data-dismiss="modal">Close</button>
				</div>			
			</div>
		</div>
	</div>

	<script type="text/javascript">

		$('#btnReg').on('click', function () {
			$('#modalBoxReg').modal('show');
		});

		$('#btnRegRegistr').on('click', function () {

			var nick = $('#inputNick').val(),
				pass = $('#inputPass').val(),
				repeatPass = $('#inputRepeatPass').val();

			if (nick.length == 0 || pass.length == 0 || repeatPass.length == 0) {
				document.getElementById('validationReg').style.display = 'block';
				document.getElementById('validationReg').innerHTML = 'Fields must not be empty'; 
			} else {
				if (pass != repeatPass) {
					document.getElementById('validationReg').style.display = 'block';
					document.getElementById('validationReg').innerHTML = 'Passwords do not match';
				} else {
					socket.emit('registration', { username: nick, password: pass });					
				}	
			}

			socket.on('registration', function (data) {
				if (data.successfully) {
					$('#modalBoxReg').modal('hide');											
				} else {
					document.getElementById('validationReg').style.display = 'block';
					document.getElementById('validationReg').innerHTML = 'Registration failed';
				}
			});
		});

		$('#inpReg').trigger('reset');
	</script>

	<div id="modalBoxResult" class="modal fade" data-backdrop="static">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Result</h4>
				</div>
				<div class="modal-body">
					<p></p>
					<p></p>
					<p></p>
				</div>
				<div class="modal-footer">
					<button id="btn-OK" class="btn btn-primary" type="button"><font>OK</font></button>
					<button id="btn-restart" class="btn btn-primary" type="button">Restart</button>
				</div>
			</div>
		</div>
	</div>

	<div id="mainScreen">
		<div id="mainScreenElements">
			<h1 id="mainScreenTitle">Rolling Sphere</h1>
			<div id="mainScreenOnline">
				<p>Online: </p>
			</div>
			
			<div id="mainScreenStatistic">				
				<p>Nickname: </p>
				<p>Best score: </p>
				<p>Coins: </p>	
				<p>Total time: </p>				
			</div>
			<div id="mainScreenTop">
				<table>
					<caption>Top</caption>
					<tr>
						<td>1</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>2</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>3</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>4</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>5</td>
						<td></td>
						<td></td>
					</tr>
				</table>
			</div>			

			<div id="btnStartGame">
				<button type="button" class="btn btn-primary">Play</button>
			</div>			
		</div>
		
	</div>

	<div id="score"><p>Score: 0</p></div>
	<div id="coins"><p>Coins: 0</p></div>
	<script type="text/javascript" src="./js/game.js"></script>
	<script type="text/javascript">
		var socket = io('http://localhost:8080');
		socket.on('connected', function(data) {
			console.log('My id : ' + data.id);
		});
		socket.on('new-player-connected', function(data) {
			console.log('New player was connected. Id: ' + data.id + "\tCurrent number of players is " + data.pNumber);
		});
		socket.on('player-disconnected', function(data) {
			console.log('Player was disconnected. Id: ' + data.id + "\tCurrent number of players is " + data.pNumber);
		});

		socket.on('new-global-top-score', function(data){
			console.log('new-global-top-score');
  			console.log(data);
  			console.log();
		});
	</script>
</body>
</html>
